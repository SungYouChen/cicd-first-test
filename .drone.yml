kind: pipeline
type: docker
name: default

steps:
- name: composer install
  image: composer
  commands:
  - echo '開始安裝 composer'
  - composer install

- name: Unit test
  image: php
  commands:
  - echo '開始單元測試123'
  - echo 'php artisan test'

- name: build image
  when:
    branch: 
    - master
  image: docker:dind
  volumes:
  - name: dockersock
    path: /var/run/docker.sock
  commands:
  - docker build --no-cache --pull --force-rm -t rain/ithome:latest -f go.dockerfile .
  volumes:
  - name: dockersock
  host:
    path: /var/run/docker.sock
